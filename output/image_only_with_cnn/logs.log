2025-04-24 14:34:42,613 [INFO] Logging setup complete.
2025-04-24 14:34:42,614 [INFO] Starting experiment: image_only_with_cnn
2025-04-24 14:34:42,614 [INFO] Configuration:
{
    "raw_data_dir": "/disk3/wangrt/model/CS5242-Project/raw_data",
    "label_file": "/disk3/wangrt/model/CS5242-Project/label.csv",
    "preprocessed_data_dir": "/disk3/wangrt/model/CS5242-Project/preprocessed_data",
    "output_dir": "/disk3/wangrt/model/CS5242-Project/output",
    "experiment_name": "image_only_with_cnn",
    "force_preprocess": false,
    "clip_model_name": "openai/clip-vit-base-patch32",
    "modality": "image",
    "freeze_clip": true,
    "projection_dim": null,
    "use_cross_attention": false,
    "num_attention_heads": 8,
    "use_cnn_layer": true,
    "cnn_out_channels_ratio": 0.5,
    "classifier_hidden_layers": [
        1024,
        512
    ],
    "num_classes": 3,
    "device": "cuda:5",
    "batch_size": 128,
    "num_epochs": 20,
    "learning_rate_clip": 1e-06,
    "learning_rate_head": 0.0001,
    "weight_decay_clip": 0.01,
    "weight_decay_head": 0.01,
    "dropout_attention": 0.1,
    "dropout_mlp": 0.15,
    "early_stopping_patience": 5,
    "num_workers": 4,
    "val_split_ratio": 0.15,
    "test_split_ratio": 0.15,
    "seed": 42,
    "max_token_length": 77,
    "label_map": {
        "negative": 0,
        "neutral": 1,
        "positive": 2
    },
    "inv_label_map": {
        "0": "negative",
        "1": "neutral",
        "2": "positive"
    },
    "experiment_output_dir": "/disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn"
}
2025-04-24 14:34:42,616 [INFO] Random seed set to 42
2025-04-24 14:34:42,619 [INFO] Creating DataLoaders...
2025-04-24 14:34:42,640 [INFO] Initializing model...
2025-04-24 14:34:45,673 [INFO] Model loaded on device: cuda:5
2025-04-24 14:34:45,674 [INFO] Setting up optimizer...
2025-04-24 14:34:45,676 [INFO] Optimizing 0 CLIP parameters with LR=1e-06, WD=0.01
2025-04-24 14:34:45,677 [INFO] Optimizing 6 Head parameters with LR=0.0001, WD=0.01
2025-04-24 14:34:45,678 [INFO] --- Starting Training ---
2025-04-24 14:34:45,678 [INFO] 
--- Epoch 1/20 ---
2025-04-24 14:34:53,471 [INFO] Epoch 1 Train Loss: 0.9333
2025-04-24 14:34:56,769 [INFO] Epoch 1 Validation Loss: 0.8633, Validation Accuracy: 0.5946
2025-04-24 14:34:56,770 [INFO] Validation Classification Report (Epoch 1):
              precision    recall  f1-score   support

    negative       0.00      0.00      0.00       336
     neutral       0.00      0.00      0.00       116
    positive       0.59      1.00      0.75       663

    accuracy                           0.59      1115
   macro avg       0.20      0.33      0.25      1115
weighted avg       0.35      0.59      0.44      1115

2025-04-24 14:34:56,770 [INFO] Epoch 1 duration: 11.09 seconds
2025-04-24 14:34:58,771 [INFO] Validation accuracy improved to 0.5946. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:34:58,772 [INFO] 
--- Epoch 2/20 ---
2025-04-24 14:35:04,917 [INFO] Epoch 2 Train Loss: 0.8185
2025-04-24 14:35:08,342 [INFO] Epoch 2 Validation Loss: 0.7820, Validation Accuracy: 0.6565
2025-04-24 14:35:08,349 [INFO] Validation Classification Report (Epoch 2):
              precision    recall  f1-score   support

    negative       0.77      0.26      0.38       336
     neutral       0.00      0.00      0.00       116
    positive       0.64      0.97      0.78       663

    accuracy                           0.66      1115
   macro avg       0.47      0.41      0.39      1115
weighted avg       0.62      0.66      0.58      1115

2025-04-24 14:35:08,349 [INFO] Epoch 2 duration: 9.58 seconds
2025-04-24 14:35:12,132 [INFO] Validation accuracy improved to 0.6565. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:35:12,132 [INFO] 
--- Epoch 3/20 ---
2025-04-24 14:35:17,298 [INFO] Epoch 3 Train Loss: 0.7186
2025-04-24 14:35:20,541 [INFO] Epoch 3 Validation Loss: 0.7137, Validation Accuracy: 0.7004
2025-04-24 14:35:20,546 [INFO] Validation Classification Report (Epoch 3):
              precision    recall  f1-score   support

    negative       0.70      0.50      0.58       336
     neutral       0.00      0.00      0.00       116
    positive       0.70      0.92      0.80       663

    accuracy                           0.70      1115
   macro avg       0.47      0.47      0.46      1115
weighted avg       0.63      0.70      0.65      1115

2025-04-24 14:35:20,547 [INFO] Epoch 3 duration: 8.41 seconds
2025-04-24 14:35:25,861 [INFO] Validation accuracy improved to 0.7004. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:35:25,862 [INFO] 
--- Epoch 4/20 ---
2025-04-24 14:35:32,269 [INFO] Epoch 4 Train Loss: 0.6406
2025-04-24 14:35:36,303 [INFO] Epoch 4 Validation Loss: 0.6820, Validation Accuracy: 0.7049
2025-04-24 14:35:36,316 [INFO] Validation Classification Report (Epoch 4):
              precision    recall  f1-score   support

    negative       0.68      0.55      0.61       336
     neutral       0.50      0.07      0.12       116
    positive       0.72      0.89      0.80       663

    accuracy                           0.70      1115
   macro avg       0.63      0.51      0.51      1115
weighted avg       0.68      0.70      0.67      1115

2025-04-24 14:35:36,317 [INFO] Epoch 4 duration: 10.45 seconds
2025-04-24 14:35:40,857 [INFO] Validation accuracy improved to 0.7049. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:35:40,858 [INFO] 
--- Epoch 5/20 ---
2025-04-24 14:35:46,868 [INFO] Epoch 5 Train Loss: 0.5931
2025-04-24 14:35:52,021 [INFO] Epoch 5 Validation Loss: 0.6704, Validation Accuracy: 0.7148
2025-04-24 14:35:52,023 [INFO] Validation Classification Report (Epoch 5):
              precision    recall  f1-score   support

    negative       0.65      0.57      0.61       336
     neutral       0.59      0.17      0.27       116
    positive       0.74      0.88      0.81       663

    accuracy                           0.71      1115
   macro avg       0.66      0.54      0.56      1115
weighted avg       0.70      0.71      0.69      1115

2025-04-24 14:35:52,023 [INFO] Epoch 5 duration: 11.17 seconds
2025-04-24 14:35:55,538 [INFO] Validation accuracy improved to 0.7148. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:35:55,539 [INFO] 
--- Epoch 6/20 ---
2025-04-24 14:36:02,451 [INFO] Epoch 6 Train Loss: 0.5558
2025-04-24 14:36:05,467 [INFO] Epoch 6 Validation Loss: 0.6652, Validation Accuracy: 0.7139
2025-04-24 14:36:05,468 [INFO] Validation Classification Report (Epoch 6):
              precision    recall  f1-score   support

    negative       0.64      0.57      0.61       336
     neutral       0.60      0.22      0.33       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.71      1115
   macro avg       0.66      0.56      0.58      1115
weighted avg       0.70      0.71      0.70      1115

2025-04-24 14:36:05,468 [INFO] Epoch 6 duration: 9.93 seconds
2025-04-24 14:36:05,469 [INFO] Validation accuracy did not improve. Current best: 0.7148. Epochs without improvement: 1/5
2025-04-24 14:36:05,469 [INFO] 
--- Epoch 7/20 ---
2025-04-24 14:36:11,650 [INFO] Epoch 7 Train Loss: 0.5302
2025-04-24 14:36:15,017 [INFO] Epoch 7 Validation Loss: 0.6658, Validation Accuracy: 0.7130
2025-04-24 14:36:15,018 [INFO] Validation Classification Report (Epoch 7):
              precision    recall  f1-score   support

    negative       0.65      0.54      0.59       336
     neutral       0.54      0.25      0.34       116
    positive       0.75      0.88      0.81       663

    accuracy                           0.71      1115
   macro avg       0.65      0.56      0.58      1115
weighted avg       0.70      0.71      0.69      1115

2025-04-24 14:36:15,018 [INFO] Epoch 7 duration: 9.55 seconds
2025-04-24 14:36:15,019 [INFO] Validation accuracy did not improve. Current best: 0.7148. Epochs without improvement: 2/5
2025-04-24 14:36:15,019 [INFO] 
--- Epoch 8/20 ---
2025-04-24 14:36:21,719 [INFO] Epoch 8 Train Loss: 0.4973
2025-04-24 14:36:24,819 [INFO] Epoch 8 Validation Loss: 0.6659, Validation Accuracy: 0.7175
2025-04-24 14:36:24,822 [INFO] Validation Classification Report (Epoch 8):
              precision    recall  f1-score   support

    negative       0.64      0.59      0.62       336
     neutral       0.52      0.28      0.36       116
    positive       0.76      0.86      0.81       663

    accuracy                           0.72      1115
   macro avg       0.64      0.58      0.60      1115
weighted avg       0.70      0.72      0.70      1115

2025-04-24 14:36:24,823 [INFO] Epoch 8 duration: 9.80 seconds
2025-04-24 14:36:28,122 [INFO] Validation accuracy improved to 0.7175. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:36:28,123 [INFO] 
--- Epoch 9/20 ---
2025-04-24 14:36:34,287 [INFO] Epoch 9 Train Loss: 0.4696
2025-04-24 14:36:37,299 [INFO] Epoch 9 Validation Loss: 0.6688, Validation Accuracy: 0.7184
2025-04-24 14:36:37,300 [INFO] Validation Classification Report (Epoch 9):
              precision    recall  f1-score   support

    negative       0.64      0.61      0.62       336
     neutral       0.52      0.28      0.36       116
    positive       0.77      0.85      0.81       663

    accuracy                           0.72      1115
   macro avg       0.64      0.58      0.60      1115
weighted avg       0.70      0.72      0.71      1115

2025-04-24 14:36:37,300 [INFO] Epoch 9 duration: 9.18 seconds
2025-04-24 14:36:39,866 [INFO] Validation accuracy improved to 0.7184. Saving best model to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth
2025-04-24 14:36:39,867 [INFO] 
--- Epoch 10/20 ---
2025-04-24 14:36:44,916 [INFO] Epoch 10 Train Loss: 0.4364
2025-04-24 14:36:49,005 [INFO] Epoch 10 Validation Loss: 0.6795, Validation Accuracy: 0.7148
2025-04-24 14:36:49,005 [INFO] Validation Classification Report (Epoch 10):
              precision    recall  f1-score   support

    negative       0.65      0.56      0.60       336
     neutral       0.53      0.26      0.35       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.71      1115
   macro avg       0.64      0.56      0.59      1115
weighted avg       0.70      0.71      0.70      1115

2025-04-24 14:36:49,006 [INFO] Epoch 10 duration: 9.14 seconds
2025-04-24 14:36:49,006 [INFO] Validation accuracy did not improve. Current best: 0.7184. Epochs without improvement: 1/5
2025-04-24 14:36:49,006 [INFO] 
--- Epoch 11/20 ---
2025-04-24 14:36:54,732 [INFO] Epoch 11 Train Loss: 0.4076
2025-04-24 14:36:59,068 [INFO] Epoch 11 Validation Loss: 0.6877, Validation Accuracy: 0.7157
2025-04-24 14:36:59,075 [INFO] Validation Classification Report (Epoch 11):
              precision    recall  f1-score   support

    negative       0.66      0.56      0.61       336
     neutral       0.55      0.25      0.34       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.72      1115
   macro avg       0.65      0.56      0.59      1115
weighted avg       0.70      0.72      0.70      1115

2025-04-24 14:36:59,076 [INFO] Epoch 11 duration: 10.07 seconds
2025-04-24 14:36:59,077 [INFO] Validation accuracy did not improve. Current best: 0.7184. Epochs without improvement: 2/5
2025-04-24 14:36:59,077 [INFO] 
--- Epoch 12/20 ---
2025-04-24 14:37:06,159 [INFO] Epoch 12 Train Loss: 0.3719
2025-04-24 14:37:09,111 [INFO] Epoch 12 Validation Loss: 0.6936, Validation Accuracy: 0.7166
2025-04-24 14:37:09,117 [INFO] Validation Classification Report (Epoch 12):
              precision    recall  f1-score   support

    negative       0.64      0.60      0.62       336
     neutral       0.55      0.26      0.35       116
    positive       0.76      0.85      0.81       663

    accuracy                           0.72      1115
   macro avg       0.65      0.57      0.59      1115
weighted avg       0.70      0.72      0.70      1115

2025-04-24 14:37:09,118 [INFO] Epoch 12 duration: 10.04 seconds
2025-04-24 14:37:09,118 [INFO] Validation accuracy did not improve. Current best: 0.7184. Epochs without improvement: 3/5
2025-04-24 14:37:09,119 [INFO] 
--- Epoch 13/20 ---
2025-04-24 14:37:16,895 [INFO] Epoch 13 Train Loss: 0.3377
2025-04-24 14:37:19,358 [INFO] Epoch 13 Validation Loss: 0.7140, Validation Accuracy: 0.7148
2025-04-24 14:37:19,367 [INFO] Validation Classification Report (Epoch 13):
              precision    recall  f1-score   support

    negative       0.66      0.56      0.61       336
     neutral       0.55      0.26      0.35       116
    positive       0.75      0.87      0.80       663

    accuracy                           0.71      1115
   macro avg       0.65      0.56      0.59      1115
weighted avg       0.70      0.71      0.70      1115

2025-04-24 14:37:19,369 [INFO] Epoch 13 duration: 10.25 seconds
2025-04-24 14:37:19,369 [INFO] Validation accuracy did not improve. Current best: 0.7184. Epochs without improvement: 4/5
2025-04-24 14:37:19,370 [INFO] 
--- Epoch 14/20 ---
2025-04-24 14:37:24,097 [INFO] Epoch 14 Train Loss: 0.3049
2025-04-24 14:37:26,843 [INFO] Epoch 14 Validation Loss: 0.7228, Validation Accuracy: 0.7184
2025-04-24 14:37:26,856 [INFO] Validation Classification Report (Epoch 14):
              precision    recall  f1-score   support

    negative       0.63      0.62      0.63       336
     neutral       0.56      0.28      0.37       116
    positive       0.77      0.84      0.80       663

    accuracy                           0.72      1115
   macro avg       0.65      0.58      0.60      1115
weighted avg       0.71      0.72      0.71      1115

2025-04-24 14:37:26,857 [INFO] Epoch 14 duration: 7.49 seconds
2025-04-24 14:37:26,858 [INFO] Validation accuracy did not improve. Current best: 0.7184. Epochs without improvement: 5/5
2025-04-24 14:37:26,858 [INFO] Early stopping triggered after 5 epochs without improvement.
2025-04-24 14:37:26,859 [INFO] 
Training finished. Best validation accuracy: 0.7184
2025-04-24 14:37:26,859 [INFO] 
--- Evaluating on Test Set ---
2025-04-24 14:37:28,314 [INFO] Loaded best model weights from /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/best_model.pth for testing.
2025-04-24 14:37:29,803 [INFO] 
Test Loss: 0.6904
2025-04-24 14:37:29,803 [INFO] Test Accuracy: 0.7071
2025-04-24 14:37:29,803 [INFO] Test Set Classification Report:
              precision    recall  f1-score   support

    negative       0.65      0.67      0.66        72
     neutral       0.40      0.16      0.23        25
    positive       0.75      0.82      0.79       142

    accuracy                           0.71       239
   macro avg       0.60      0.55      0.56       239
weighted avg       0.69      0.71      0.69       239

2025-04-24 14:37:29,804 [INFO] Results saved to /disk3/wangrt/model/CS5242-Project/output/image_only_with_cnn/test_results.json
2025-04-24 14:37:29,804 [INFO] --- Experiment Finished: image_only_with_cnn ---
