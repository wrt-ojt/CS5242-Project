2025-04-24 14:40:51,637 [INFO] Logging setup complete.
2025-04-24 14:40:51,638 [INFO] Starting experiment: text_only_with_cnn
2025-04-24 14:40:51,638 [INFO] Configuration:
{
    "raw_data_dir": "/disk3/wangrt/model/CS5242-Project/raw_data",
    "label_file": "/disk3/wangrt/model/CS5242-Project/label.csv",
    "preprocessed_data_dir": "/disk3/wangrt/model/CS5242-Project/preprocessed_data",
    "output_dir": "/disk3/wangrt/model/CS5242-Project/output",
    "experiment_name": "text_only_with_cnn",
    "force_preprocess": false,
    "clip_model_name": "openai/clip-vit-base-patch32",
    "modality": "text",
    "freeze_clip": true,
    "projection_dim": null,
    "use_cross_attention": false,
    "num_attention_heads": 8,
    "use_cnn_layer": true,
    "cnn_out_channels_ratio": 0.5,
    "classifier_hidden_layers": [
        1024,
        512
    ],
    "num_classes": 3,
    "device": "cuda:5",
    "batch_size": 128,
    "num_epochs": 20,
    "learning_rate_clip": 1e-06,
    "learning_rate_head": 0.0001,
    "weight_decay_clip": 0.01,
    "weight_decay_head": 0.01,
    "dropout_attention": 0.1,
    "dropout_mlp": 0.15,
    "early_stopping_patience": 5,
    "num_workers": 4,
    "val_split_ratio": 0.15,
    "test_split_ratio": 0.15,
    "seed": 42,
    "max_token_length": 77,
    "label_map": {
        "negative": 0,
        "neutral": 1,
        "positive": 2
    },
    "inv_label_map": {
        "0": "negative",
        "1": "neutral",
        "2": "positive"
    },
    "experiment_output_dir": "/disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn"
}
2025-04-24 14:40:51,640 [INFO] Random seed set to 42
2025-04-24 14:40:51,643 [INFO] Creating DataLoaders...
2025-04-24 14:40:51,656 [INFO] Initializing model...
2025-04-24 14:40:55,609 [INFO] Model loaded on device: cuda:5
2025-04-24 14:40:55,611 [INFO] Setting up optimizer...
2025-04-24 14:40:55,613 [INFO] Optimizing 0 CLIP parameters with LR=1e-06, WD=0.01
2025-04-24 14:40:55,613 [INFO] Optimizing 6 Head parameters with LR=0.0001, WD=0.01
2025-04-24 14:40:55,614 [INFO] --- Starting Training ---
2025-04-24 14:40:55,615 [INFO] 
--- Epoch 1/20 ---
2025-04-24 14:41:03,051 [INFO] Epoch 1 Train Loss: 0.9483
2025-04-24 14:41:06,345 [INFO] Epoch 1 Validation Loss: 0.8881, Validation Accuracy: 0.5946
2025-04-24 14:41:06,351 [INFO] Validation Classification Report (Epoch 1):
              precision    recall  f1-score   support

    negative       0.00      0.00      0.00       336
     neutral       0.00      0.00      0.00       116
    positive       0.59      1.00      0.75       663

    accuracy                           0.59      1115
   macro avg       0.20      0.33      0.25      1115
weighted avg       0.35      0.59      0.44      1115

2025-04-24 14:41:06,352 [INFO] Epoch 1 duration: 10.74 seconds
2025-04-24 14:41:10,078 [INFO] Validation accuracy improved to 0.5946. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:41:10,078 [INFO] 
--- Epoch 2/20 ---
2025-04-24 14:41:17,099 [INFO] Epoch 2 Train Loss: 0.8662
2025-04-24 14:41:20,560 [INFO] Epoch 2 Validation Loss: 0.8530, Validation Accuracy: 0.5955
2025-04-24 14:41:20,560 [INFO] Validation Classification Report (Epoch 2):
              precision    recall  f1-score   support

    negative       1.00      0.00      0.01       336
     neutral       0.00      0.00      0.00       116
    positive       0.60      1.00      0.75       663

    accuracy                           0.60      1115
   macro avg       0.53      0.33      0.25      1115
weighted avg       0.66      0.60      0.45      1115

2025-04-24 14:41:20,560 [INFO] Epoch 2 duration: 10.48 seconds
2025-04-24 14:41:24,033 [INFO] Validation accuracy improved to 0.5955. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:41:24,033 [INFO] 
--- Epoch 3/20 ---
2025-04-24 14:41:29,956 [INFO] Epoch 3 Train Loss: 0.8159
2025-04-24 14:41:34,246 [INFO] Epoch 3 Validation Loss: 0.8008, Validation Accuracy: 0.6305
2025-04-24 14:41:34,252 [INFO] Validation Classification Report (Epoch 3):
              precision    recall  f1-score   support

    negative       0.75      0.16      0.26       336
     neutral       0.00      0.00      0.00       116
    positive       0.62      0.98      0.76       663

    accuracy                           0.63      1115
   macro avg       0.46      0.38      0.34      1115
weighted avg       0.60      0.63      0.53      1115

2025-04-24 14:41:34,252 [INFO] Epoch 3 duration: 10.22 seconds
2025-04-24 14:41:36,516 [INFO] Validation accuracy improved to 0.6305. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:41:36,518 [INFO] 
--- Epoch 4/20 ---
2025-04-24 14:41:42,418 [INFO] Epoch 4 Train Loss: 0.7489
2025-04-24 14:41:46,244 [INFO] Epoch 4 Validation Loss: 0.7459, Validation Accuracy: 0.6861
2025-04-24 14:41:46,252 [INFO] Validation Classification Report (Epoch 4):
              precision    recall  f1-score   support

    negative       0.70      0.43      0.53       336
     neutral       1.00      0.01      0.02       116
    positive       0.68      0.94      0.79       663

    accuracy                           0.69      1115
   macro avg       0.80      0.46      0.45      1115
weighted avg       0.72      0.69      0.63      1115

2025-04-24 14:41:46,252 [INFO] Epoch 4 duration: 9.73 seconds
2025-04-24 14:41:51,194 [INFO] Validation accuracy improved to 0.6861. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:41:51,195 [INFO] 
--- Epoch 5/20 ---
2025-04-24 14:41:56,768 [INFO] Epoch 5 Train Loss: 0.6888
2025-04-24 14:42:00,362 [INFO] Epoch 5 Validation Loss: 0.7115, Validation Accuracy: 0.7085
2025-04-24 14:42:00,368 [INFO] Validation Classification Report (Epoch 5):
              precision    recall  f1-score   support

    negative       0.68      0.54      0.60       336
     neutral       0.59      0.09      0.15       116
    positive       0.72      0.90      0.80       663

    accuracy                           0.71      1115
   macro avg       0.66      0.51      0.52      1115
weighted avg       0.69      0.71      0.67      1115

2025-04-24 14:42:00,368 [INFO] Epoch 5 duration: 9.17 seconds
2025-04-24 14:42:05,978 [INFO] Validation accuracy improved to 0.7085. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:42:05,978 [INFO] 
--- Epoch 6/20 ---
2025-04-24 14:42:12,388 [INFO] Epoch 6 Train Loss: 0.6387
2025-04-24 14:42:16,896 [INFO] Epoch 6 Validation Loss: 0.6931, Validation Accuracy: 0.7148
2025-04-24 14:42:16,901 [INFO] Validation Classification Report (Epoch 6):
              precision    recall  f1-score   support

    negative       0.69      0.54      0.61       336
     neutral       0.56      0.12      0.20       116
    positive       0.73      0.91      0.81       663

    accuracy                           0.71      1115
   macro avg       0.66      0.52      0.54      1115
weighted avg       0.70      0.71      0.68      1115

2025-04-24 14:42:16,902 [INFO] Epoch 6 duration: 10.92 seconds
2025-04-24 14:42:20,576 [INFO] Validation accuracy improved to 0.7148. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:42:20,577 [INFO] 
--- Epoch 7/20 ---
2025-04-24 14:42:26,945 [INFO] Epoch 7 Train Loss: 0.6066
2025-04-24 14:42:30,497 [INFO] Epoch 7 Validation Loss: 0.6859, Validation Accuracy: 0.7193
2025-04-24 14:42:30,498 [INFO] Validation Classification Report (Epoch 7):
              precision    recall  f1-score   support

    negative       0.65      0.61      0.63       336
     neutral       0.56      0.19      0.28       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.72      1115
   macro avg       0.66      0.56      0.57      1115
weighted avg       0.70      0.72      0.70      1115

2025-04-24 14:42:30,498 [INFO] Epoch 7 duration: 9.92 seconds
2025-04-24 14:42:34,705 [INFO] Validation accuracy improved to 0.7193. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:42:34,706 [INFO] 
--- Epoch 8/20 ---
2025-04-24 14:42:41,353 [INFO] Epoch 8 Train Loss: 0.5728
2025-04-24 14:42:44,611 [INFO] Epoch 8 Validation Loss: 0.6831, Validation Accuracy: 0.7202
2025-04-24 14:42:44,623 [INFO] Validation Classification Report (Epoch 8):
              precision    recall  f1-score   support

    negative       0.66      0.61      0.63       336
     neutral       0.61      0.19      0.29       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.72      1115
   macro avg       0.67      0.56      0.58      1115
weighted avg       0.71      0.72      0.70      1115

2025-04-24 14:42:44,624 [INFO] Epoch 8 duration: 9.92 seconds
2025-04-24 14:42:47,720 [INFO] Validation accuracy improved to 0.7202. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:42:47,721 [INFO] 
--- Epoch 9/20 ---
2025-04-24 14:42:53,691 [INFO] Epoch 9 Train Loss: 0.5412
2025-04-24 14:42:56,557 [INFO] Epoch 9 Validation Loss: 0.6847, Validation Accuracy: 0.7220
2025-04-24 14:42:56,558 [INFO] Validation Classification Report (Epoch 9):
              precision    recall  f1-score   support

    negative       0.66      0.62      0.64       336
     neutral       0.57      0.20      0.29       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.72      1115
   macro avg       0.66      0.56      0.58      1115
weighted avg       0.71      0.72      0.70      1115

2025-04-24 14:42:56,558 [INFO] Epoch 9 duration: 8.84 seconds
2025-04-24 14:42:59,360 [INFO] Validation accuracy improved to 0.7220. Saving best model to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth
2025-04-24 14:42:59,361 [INFO] 
--- Epoch 10/20 ---
2025-04-24 14:43:04,363 [INFO] Epoch 10 Train Loss: 0.5086
2025-04-24 14:43:08,579 [INFO] Epoch 10 Validation Loss: 0.6867, Validation Accuracy: 0.7202
2025-04-24 14:43:08,579 [INFO] Validation Classification Report (Epoch 10):
              precision    recall  f1-score   support

    negative       0.66      0.61      0.63       336
     neutral       0.56      0.20      0.29       116
    positive       0.75      0.87      0.81       663

    accuracy                           0.72      1115
   macro avg       0.66      0.56      0.58      1115
weighted avg       0.71      0.72      0.70      1115

2025-04-24 14:43:08,579 [INFO] Epoch 10 duration: 9.22 seconds
2025-04-24 14:43:08,579 [INFO] Validation accuracy did not improve. Current best: 0.7220. Epochs without improvement: 1/5
2025-04-24 14:43:08,579 [INFO] 
--- Epoch 11/20 ---
2025-04-24 14:43:15,527 [INFO] Epoch 11 Train Loss: 0.4775
2025-04-24 14:43:19,304 [INFO] Epoch 11 Validation Loss: 0.6964, Validation Accuracy: 0.7139
2025-04-24 14:43:19,308 [INFO] Validation Classification Report (Epoch 11):
              precision    recall  f1-score   support

    negative       0.65      0.62      0.63       336
     neutral       0.51      0.19      0.28       116
    positive       0.75      0.85      0.80       663

    accuracy                           0.71      1115
   macro avg       0.64      0.55      0.57      1115
weighted avg       0.70      0.71      0.70      1115

2025-04-24 14:43:19,308 [INFO] Epoch 11 duration: 10.73 seconds
2025-04-24 14:43:19,308 [INFO] Validation accuracy did not improve. Current best: 0.7220. Epochs without improvement: 2/5
2025-04-24 14:43:19,309 [INFO] 
--- Epoch 12/20 ---
2025-04-24 14:43:26,335 [INFO] Epoch 12 Train Loss: 0.4505
2025-04-24 14:43:30,082 [INFO] Epoch 12 Validation Loss: 0.7068, Validation Accuracy: 0.7112
2025-04-24 14:43:30,101 [INFO] Validation Classification Report (Epoch 12):
              precision    recall  f1-score   support

    negative       0.67      0.60      0.63       336
     neutral       0.46      0.18      0.26       116
    positive       0.74      0.86      0.80       663

    accuracy                           0.71      1115
   macro avg       0.62      0.55      0.56      1115
weighted avg       0.69      0.71      0.69      1115

2025-04-24 14:43:30,102 [INFO] Epoch 12 duration: 10.79 seconds
2025-04-24 14:43:30,102 [INFO] Validation accuracy did not improve. Current best: 0.7220. Epochs without improvement: 3/5
2025-04-24 14:43:30,103 [INFO] 
--- Epoch 13/20 ---
2025-04-24 14:43:37,022 [INFO] Epoch 13 Train Loss: 0.4172
2025-04-24 14:43:41,179 [INFO] Epoch 13 Validation Loss: 0.7101, Validation Accuracy: 0.7103
2025-04-24 14:43:41,183 [INFO] Validation Classification Report (Epoch 13):
              precision    recall  f1-score   support

    negative       0.66      0.60      0.63       336
     neutral       0.44      0.20      0.27       116
    positive       0.75      0.86      0.80       663

    accuracy                           0.71      1115
   macro avg       0.62      0.55      0.57      1115
weighted avg       0.69      0.71      0.69      1115

2025-04-24 14:43:41,184 [INFO] Epoch 13 duration: 11.08 seconds
2025-04-24 14:43:41,184 [INFO] Validation accuracy did not improve. Current best: 0.7220. Epochs without improvement: 4/5
2025-04-24 14:43:41,185 [INFO] 
--- Epoch 14/20 ---
2025-04-24 14:43:47,153 [INFO] Epoch 14 Train Loss: 0.3816
2025-04-24 14:43:50,140 [INFO] Epoch 14 Validation Loss: 0.7248, Validation Accuracy: 0.7094
2025-04-24 14:43:50,141 [INFO] Validation Classification Report (Epoch 14):
              precision    recall  f1-score   support

    negative       0.64      0.62      0.63       336
     neutral       0.44      0.21      0.28       116
    positive       0.76      0.84      0.80       663

    accuracy                           0.71      1115
   macro avg       0.62      0.56      0.57      1115
weighted avg       0.69      0.71      0.69      1115

2025-04-24 14:43:50,141 [INFO] Epoch 14 duration: 8.96 seconds
2025-04-24 14:43:50,141 [INFO] Validation accuracy did not improve. Current best: 0.7220. Epochs without improvement: 5/5
2025-04-24 14:43:50,142 [INFO] Early stopping triggered after 5 epochs without improvement.
2025-04-24 14:43:50,142 [INFO] 
Training finished. Best validation accuracy: 0.7220
2025-04-24 14:43:50,142 [INFO] 
--- Evaluating on Test Set ---
2025-04-24 14:43:51,188 [INFO] Loaded best model weights from /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/best_model.pth for testing.
2025-04-24 14:43:54,465 [INFO] 
Test Loss: 0.6998
2025-04-24 14:43:54,477 [INFO] Test Accuracy: 0.7155
2025-04-24 14:43:54,478 [INFO] Test Set Classification Report:
              precision    recall  f1-score   support

    negative       0.65      0.62      0.64        72
     neutral       0.60      0.12      0.20        25
    positive       0.75      0.87      0.80       142

    accuracy                           0.72       239
   macro avg       0.67      0.54      0.55       239
weighted avg       0.70      0.72      0.69       239

2025-04-24 14:43:54,481 [INFO] Results saved to /disk3/wangrt/model/CS5242-Project/output/text_only_with_cnn/test_results.json
2025-04-24 14:43:54,482 [INFO] --- Experiment Finished: text_only_with_cnn ---
