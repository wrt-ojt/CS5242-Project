2025-04-22 18:16:28,715 [INFO] Logging setup complete.
2025-04-22 18:16:28,715 [INFO] Starting experiment: multimodal_cross_attention_projection_cnn_linear_less_mlp
2025-04-22 18:16:28,715 [INFO] Configuration:
{
    "raw_data_dir": "/disk3/wangrt/model/CS5242-Project/raw_data",
    "label_file": "/disk3/wangrt/model/CS5242-Project/label.csv",
    "preprocessed_data_dir": "/disk3/wangrt/model/CS5242-Project/preprocessed_data",
    "output_dir": "/disk3/wangrt/model/CS5242-Project/output",
    "experiment_name": "multimodal_cross_attention_projection_cnn_linear_less_mlp",
    "force_preprocess": false,
    "clip_model_name": "openai/clip-vit-base-patch32",
    "modality": "multimodal",
    "freeze_clip": false,
    "projection_dim": null,
    "use_cross_attention": true,
    "num_attention_heads": 8,
    "use_cnn_layer": false,
    "cnn_out_channels_ratio": 0.5,
    "classifier_hidden_layers": [
        512,
        256
    ],
    "num_classes": 3,
    "device": "cuda",
    "batch_size": 32,
    "num_epochs": 10,
    "learning_rate_clip": 0.0001,
    "learning_rate_head": 0.001,
    "weight_decay_clip": 0.01,
    "weight_decay_head": 0.01,
    "dropout_attention": 0.1,
    "dropout_mlp": 0.3,
    "early_stopping_patience": 5,
    "num_workers": 4,
    "val_split_ratio": 0.15,
    "test_split_ratio": 0.15,
    "seed": 42,
    "max_token_length": 77,
    "label_map": {
        "negative": 0,
        "neutral": 1,
        "positive": 2
    },
    "inv_label_map": {
        "0": "negative",
        "1": "neutral",
        "2": "positive"
    },
    "experiment_output_dir": "/disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp"
}
2025-04-22 18:16:28,717 [INFO] Random seed set to 42
2025-04-22 18:16:28,718 [INFO] Creating DataLoaders...
2025-04-22 18:16:28,726 [INFO] Initializing model...
2025-04-22 18:16:30,629 [INFO] Model loaded on device: cuda
2025-04-22 18:16:30,629 [INFO] Setting up optimizer...
2025-04-22 18:16:30,631 [INFO] Optimizing 398 CLIP parameters with LR=0.0001, WD=0.01
2025-04-22 18:16:30,631 [INFO] Optimizing 14 Head parameters with LR=0.001, WD=0.01
2025-04-22 18:16:30,632 [INFO] --- Starting Training ---
2025-04-22 18:16:30,632 [INFO] 
--- Epoch 1/10 ---
2025-04-22 18:16:40,946 [INFO] Epoch 1 Train Loss: 0.9012
2025-04-22 18:16:42,422 [INFO] Epoch 1 Validation Loss: 0.8547, Validation Accuracy: 0.5946
2025-04-22 18:16:42,422 [INFO] Validation Classification Report (Epoch 1):
              precision    recall  f1-score   support

    negative       0.00      0.00      0.00       336
     neutral       0.00      0.00      0.00       116
    positive       0.59      1.00      0.75       663

    accuracy                           0.59      1115
   macro avg       0.20      0.33      0.25      1115
weighted avg       0.35      0.59      0.44      1115

2025-04-22 18:16:42,422 [INFO] Epoch 1 duration: 11.79 seconds
2025-04-22 18:16:43,535 [INFO] Validation accuracy improved to 0.5946. Saving best model to /disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp/best_model.pth
2025-04-22 18:16:43,535 [INFO] 
--- Epoch 2/10 ---
2025-04-22 18:16:52,885 [INFO] Epoch 2 Train Loss: 0.7936
2025-04-22 18:16:54,355 [INFO] Epoch 2 Validation Loss: 0.8299, Validation Accuracy: 0.6538
2025-04-22 18:16:54,355 [INFO] Validation Classification Report (Epoch 2):
              precision    recall  f1-score   support

    negative       0.59      0.52      0.55       336
     neutral       0.31      0.31      0.31       116
    positive       0.74      0.78      0.76       663

    accuracy                           0.65      1115
   macro avg       0.54      0.54      0.54      1115
weighted avg       0.65      0.65      0.65      1115

2025-04-22 18:16:54,355 [INFO] Epoch 2 duration: 10.82 seconds
2025-04-22 18:16:55,937 [INFO] Validation accuracy improved to 0.6538. Saving best model to /disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp/best_model.pth
2025-04-22 18:16:55,937 [INFO] 
--- Epoch 3/10 ---
2025-04-22 18:17:05,388 [INFO] Epoch 3 Train Loss: 0.5829
2025-04-22 18:17:06,775 [INFO] Epoch 3 Validation Loss: 0.9236, Validation Accuracy: 0.6413
2025-04-22 18:17:06,775 [INFO] Validation Classification Report (Epoch 3):
              precision    recall  f1-score   support

    negative       0.49      0.68      0.57       336
     neutral       0.55      0.14      0.22       116
    positive       0.76      0.71      0.73       663

    accuracy                           0.64      1115
   macro avg       0.60      0.51      0.51      1115
weighted avg       0.66      0.64      0.63      1115

2025-04-22 18:17:06,775 [INFO] Epoch 3 duration: 10.84 seconds
2025-04-22 18:17:06,775 [INFO] Validation accuracy did not improve. Current best: 0.6538. Epochs without improvement: 1/5
2025-04-22 18:17:06,775 [INFO] 
--- Epoch 4/10 ---
2025-04-22 18:17:16,233 [INFO] Epoch 4 Train Loss: 0.4178
2025-04-22 18:17:17,742 [INFO] Epoch 4 Validation Loss: 1.0404, Validation Accuracy: 0.6565
2025-04-22 18:17:17,743 [INFO] Validation Classification Report (Epoch 4):
              precision    recall  f1-score   support

    negative       0.55      0.64      0.59       336
     neutral       0.38      0.21      0.27       116
    positive       0.75      0.74      0.74       663

    accuracy                           0.66      1115
   macro avg       0.56      0.53      0.53      1115
weighted avg       0.65      0.66      0.65      1115

2025-04-22 18:17:17,743 [INFO] Epoch 4 duration: 10.97 seconds
2025-04-22 18:17:19,276 [INFO] Validation accuracy improved to 0.6565. Saving best model to /disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp/best_model.pth
2025-04-22 18:17:19,276 [INFO] 
--- Epoch 5/10 ---
2025-04-22 18:17:28,697 [INFO] Epoch 5 Train Loss: 0.2701
2025-04-22 18:17:30,182 [INFO] Epoch 5 Validation Loss: 0.9650, Validation Accuracy: 0.6556
2025-04-22 18:17:30,183 [INFO] Validation Classification Report (Epoch 5):
              precision    recall  f1-score   support

    negative       0.55      0.63      0.59       336
     neutral       0.37      0.22      0.27       116
    positive       0.75      0.74      0.74       663

    accuracy                           0.66      1115
   macro avg       0.56      0.53      0.54      1115
weighted avg       0.65      0.66      0.65      1115

2025-04-22 18:17:30,183 [INFO] Epoch 5 duration: 10.91 seconds
2025-04-22 18:17:30,183 [INFO] Validation accuracy did not improve. Current best: 0.6565. Epochs without improvement: 1/5
2025-04-22 18:17:30,183 [INFO] 
--- Epoch 6/10 ---
2025-04-22 18:17:39,645 [INFO] Epoch 6 Train Loss: 0.1777
2025-04-22 18:17:41,089 [INFO] Epoch 6 Validation Loss: 1.2786, Validation Accuracy: 0.6260
2025-04-22 18:17:41,089 [INFO] Validation Classification Report (Epoch 6):
              precision    recall  f1-score   support

    negative       0.51      0.65      0.57       336
     neutral       0.32      0.24      0.27       116
    positive       0.76      0.68      0.72       663

    accuracy                           0.63      1115
   macro avg       0.53      0.52      0.52      1115
weighted avg       0.64      0.63      0.63      1115

2025-04-22 18:17:41,089 [INFO] Epoch 6 duration: 10.91 seconds
2025-04-22 18:17:41,089 [INFO] Validation accuracy did not improve. Current best: 0.6565. Epochs without improvement: 2/5
2025-04-22 18:17:41,089 [INFO] 
--- Epoch 7/10 ---
2025-04-22 18:17:50,657 [INFO] Epoch 7 Train Loss: 0.1242
2025-04-22 18:17:52,091 [INFO] Epoch 7 Validation Loss: 1.2824, Validation Accuracy: 0.5928
2025-04-22 18:17:52,092 [INFO] Validation Classification Report (Epoch 7):
              precision    recall  f1-score   support

    negative       0.50      0.62      0.55       336
     neutral       0.26      0.34      0.30       116
    positive       0.76      0.62      0.68       663

    accuracy                           0.59      1115
   macro avg       0.51      0.53      0.51      1115
weighted avg       0.63      0.59      0.60      1115

2025-04-22 18:17:52,092 [INFO] Epoch 7 duration: 11.00 seconds
2025-04-22 18:17:52,092 [INFO] Validation accuracy did not improve. Current best: 0.6565. Epochs without improvement: 3/5
2025-04-22 18:17:52,092 [INFO] 
--- Epoch 8/10 ---
2025-04-22 18:18:01,469 [INFO] Epoch 8 Train Loss: 0.1142
2025-04-22 18:18:02,965 [INFO] Epoch 8 Validation Loss: 1.4883, Validation Accuracy: 0.6520
2025-04-22 18:18:02,966 [INFO] Validation Classification Report (Epoch 8):
              precision    recall  f1-score   support

    negative       0.60      0.39      0.47       336
     neutral       0.36      0.17      0.23       116
    positive       0.68      0.87      0.77       663

    accuracy                           0.65      1115
   macro avg       0.55      0.48      0.49      1115
weighted avg       0.63      0.65      0.62      1115

2025-04-22 18:18:02,966 [INFO] Epoch 8 duration: 10.87 seconds
2025-04-22 18:18:02,966 [INFO] Validation accuracy did not improve. Current best: 0.6565. Epochs without improvement: 4/5
2025-04-22 18:18:02,966 [INFO] 
--- Epoch 9/10 ---
2025-04-22 18:18:12,417 [INFO] Epoch 9 Train Loss: 0.1093
2025-04-22 18:18:13,857 [INFO] Epoch 9 Validation Loss: 1.3050, Validation Accuracy: 0.6323
2025-04-22 18:18:13,858 [INFO] Validation Classification Report (Epoch 9):
              precision    recall  f1-score   support

    negative       0.58      0.53      0.55       336
     neutral       0.26      0.23      0.25       116
    positive       0.71      0.75      0.73       663

    accuracy                           0.63      1115
   macro avg       0.52      0.51      0.51      1115
weighted avg       0.62      0.63      0.63      1115

2025-04-22 18:18:13,858 [INFO] Epoch 9 duration: 10.89 seconds
2025-04-22 18:18:13,858 [INFO] Validation accuracy did not improve. Current best: 0.6565. Epochs without improvement: 5/5
2025-04-22 18:18:13,858 [INFO] Early stopping triggered after 5 epochs without improvement.
2025-04-22 18:18:13,858 [INFO] 
Training finished. Best validation accuracy: 0.6565
2025-04-22 18:18:13,858 [INFO] 
--- Evaluating on Test Set ---
2025-04-22 18:18:14,349 [INFO] Loaded best model weights from /disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp/best_model.pth for testing.
2025-04-22 18:18:15,170 [INFO] 
Test Loss: 1.1685
2025-04-22 18:18:15,170 [INFO] Test Accuracy: 0.5607
2025-04-22 18:18:15,170 [INFO] Test Set Classification Report:
              precision    recall  f1-score   support

    negative       0.43      0.51      0.47        72
     neutral       0.25      0.16      0.20        25
    positive       0.68      0.65      0.67       142

    accuracy                           0.56       239
   macro avg       0.45      0.44      0.44       239
weighted avg       0.56      0.56      0.56       239

2025-04-22 18:18:15,171 [INFO] Results saved to /disk3/wangrt/model/CS5242-Project/output/multimodal_cross_attention_projection_cnn_linear_less_mlp/test_results.json
2025-04-22 18:18:15,171 [INFO] --- Experiment Finished: multimodal_cross_attention_projection_cnn_linear_less_mlp ---
